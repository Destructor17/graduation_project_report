
Так как современные веб-браузеры имеют поддержку WebAssembly API \cite{WasmBrowserSupport}, его использование для данной платформы целесообразно.
По этой причине в разрабатываемую среду выполнения кода добавлена возможность выполнять код, используя WebAssembly API.

Веб-браузеры требуют асинхронного выполнения кода. 
Это значит, что в выполнение кода должно быстро завершаться и начинаться заново при таких событиях, как нажатие клавиши, кнопки мыши или касание.
До тех пор, пока выполняется код, содержимое страницы не может быть обновлено.
Так как многие приложения являются синхронными и могут работать в течении продолжительного промежутка времени, пользователь не сможет взаимодействовать с такими программами во время их выполнения.
Emscripten, с помощью которого происходит компиляция разрабатываемой среды выполнения для веб-браузеров, имеет функционал, позволяющий асинхронно выполнять код, а вот WebAssembly API сам по себе такого функционала не имеет.

Эта проблема может быть решена с использованием Web Worker.
Web Worker позволяет выполнять код параллельно с основной частью программы, не блокируя её выполнение.
Web Worker обменивается информацией с основной частью программы с помощью сообщений. \cite{WebWorkerMessages}
Для выполнения кода с помощью WebAssembly API создаётся Web Worker, который получает сообщение от основной части программы, содержащее код приложения, после чего начинает его выполнение.
Во время выполнения кода приложения Web Worker может отправлять сообщения основной части программы, но не может их получать, так как получение сообщений является асинхронным.
Поэтому, когда приложение вызывает импортируемую функцию, основной части программы отправляется сообщение с идентификатором вызванной функции и её аргументами, а результат работы функции передаётся обратно в Web Worker с помощью SharedArrayBuffer и Atomics.

SharedArrayBuffer является объектом, ссылающимся бинарные данные.
Два объекта SharedArrayBuffer могут ссылаться на одни и те же данные, даже если один из них находится в основной части программы, а второй - в Web Worker.
Из-за существования уязвимости Spectre, создание объекта SharedArrayBuffer требует соблюдения условий, обеспечивающих достаточные уровни безопасности и конфиденциальности \cite{SharedArrayBuffer}. В большинстве случаев достаточно добавить следующие HTTP-заголовочники:
\begin{itemize}
    \item[-] Cross-Origin-Opener-Policy со значением same-origin 
    \item[-] Cross-Origin-Embedder-Policy со значением require-corp
\end{itemize}

Atomics предоставляет некоторые методы для работы с SharedArrayBuffer.
В рамках дипломного проекта использованы методы Atomics.wait и Atomics.notify.
Atomics.wait вызывается в Web Worker при ожидании ответа на сообщение о вызове импортируемой функции.
Atomics.notify вызывается в основной части программы сразу после того, как в объект SharedArrayBuffer записан результат выполнения функции, и уведомляет Web Worker о получении результата.

